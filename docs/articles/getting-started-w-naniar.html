<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with naniar • naniar</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">naniar</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started-w-naniar.html">Getting Started with naniar</a>
    </li>
    <li>
      <a href="../articles/naniar-visualisation.html">Gallery of missing data visualisations with naniar + visdat</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/njtierney/naniar">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Getting Started with naniar</h1>
                        <h4 class="author">Nicholas Tierney</h4>
            
            <h4 class="date">2017-08-07</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Missing values are ubiquitous in data and need to be carefully explored and handled in the initial stages of analysis. In this vignette we describe the tools in the package <code>naniar</code> for exploring missing data structures with minimal deviation from the common workflows of ggplot and tidy data <span class="citation">[@Wickham2014; @Wickham2009]</span>.</p>
<p>Sometimes researchers or analysts will introduce or describe a mechanism for missingness. For example, they might explain that data from a weather station might has a malfunction when there are extreme weather events, and does not record temperature data when gusts speeds are high. This seems like a nice simple, logical explanation. However, like all good explanations, this one is simple, but the process to get there, probably was not, and likely involved more time than you would have liked developing exploratory data analyses and models.</p>
<p>So when someone presents a really obvious plot like this, with a nice sensible explanation, the initial thought might be:</p>
<blockquote>
<p>They worked it out themselves so quickly, so easy!</p>
</blockquote>
<p>As if they somehow <em>accidentally</em> solved the problem, it was so easy. They couldn’t not solve it. However, I think that if you manage to get that on the first go, that is more like turning around and throwing a rock into a lake and it landing in a cup in a boat. It is unlikely.</p>
<p>With that thought in mind, this vignette aims to work with the following three questions, using the tools developed in naniar and another package, visdat. Namely, how do we:</p>
<ol style="list-style-type: decimal">
<li>Start looking at missing data?</li>
<li>Explore missingness mechanisms?</li>
<li>Model missingness?</li>
</ol>
</div>
<div id="how-do-we-start-looking-at-missing-data" class="section level1">
<h1 class="hasAnchor">
<a href="#how-do-we-start-looking-at-missing-data" class="anchor"></a>How do we start looking at missing data?</h1>
<p>When you start with a dataset, you might do something where you look at the general summary, using functions such as:</p>
<ul>
<li><code>summary()</code></li>
<li><code>str()</code></li>
<li>
<a href="https://github.com/ropenscilabs/skimr"><code><a href="http://www.rdocumentation.org/packages/skimr/topics/skim">skimr::skim</a></code></a>, or</li>
<li><code><a href="http://dplyr.tidyverse.org/reference/reexports.html">dplyr::glimpse()</a></code></li>
</ul>
<p>These works really well when you’ve got a small amount of data, but when you have more data, you are generally limited by how much you can read.</p>
<p>So before you start looking at missing data, you’ll need to look at the data, but what does that even mean?</p>
<p>The package <code>visdat</code> helps you get a handle on this. <code>visdat</code> provides a visualisation of an entire data frame at once, and was heavily inspired by <a href="http://setosa.io/blog/2014/08/03/csv-fingerprints/"><code>csv-fingerprint</code></a>, and the missingness map functions from packages like <code><a href="http://www.rdocumentation.org/packages/Amelia/topics/missmap">Amelia::missmap</a></code>.</p>
<p>There are two main functions in the <code>visdat</code> package:</p>
<ul>
<li>
<code>vis_dat</code>, and</li>
<li><code>vis_miss</code></li>
</ul>
<div id="vis_dat" class="section level2">
<h2 class="hasAnchor">
<a href="#vis_dat" class="anchor"></a><code>vis_dat</code>
</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(visdat)
<span class="kw"><a href="http://www.rdocumentation.org/packages/visdat/topics/vis_dat">vis_dat</a></span>(airquality)</code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/vis-dat-1.png" width="480" style="display: block; margin: auto;"></p>
<p>These visualise the whole dataframe at once, and provide some useful information about whether the data is missing or not. It also provides information about the class of the data input into R.</p>
<p>The function <code>vis_miss</code> provides a summary of whether the data is all present, and also provides small summaries in each column as to the amount of missings in each of the columns.</p>
<div id="vis_miss" class="section level3">
<h3 class="hasAnchor">
<a href="#vis_miss" class="anchor"></a><code>vis_miss</code>
</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/visdat/topics/vis_miss">vis_miss</a></span>(airquality)</code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/vis-miss-cluster-vanilla-1.png" width="480" style="display: block; margin: auto;"></p>
<p>To read more about the functions available in <code>visdat</code> see the vignette <a href="https://CRAN.R-project.org/package=visdat/vignettes/using_visdat.html">“Using visdat”</a></p>
</div>
</div>
</div>
<div id="exploring-missingness-relationships" class="section level1">
<h1 class="hasAnchor">
<a href="#exploring-missingness-relationships" class="anchor"></a>Exploring missingness relationships</h1>
<p>We can identify key variables that are missing using <code>vis_miss</code>, but for further exploration, we need to explore the relationship amongst the variables in this data:</p>
<ul>
<li>Ozone,</li>
<li>Solar.R</li>
<li>Wind</li>
<li>Temp</li>
<li>Month</li>
<li>Day</li>
</ul>
<p>Typically, when exploring this data, you might want to explore the variables Solar.R and Ozone, and so plot a scatterplot of solar radiation and ozone, doing something like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(airquality, 
       <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> Solar.R, 
           <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()</code></pre></div>
<pre><code>## Warning: Removed 42 rows containing missing values (geom_point).</code></pre>
<p><img src="getting-started-w-naniar_files/figure-html/unnamed-chunk-1-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The problem with this is that ggplot does not handle missings be default, and removes the missing values. This makes them hard to explore, it is a little strange - how do you visualise something that is not there? One approach to visualising missing data comes from ggobi and manet, where we replace “NA” values with values 10% lower than the minimum value in that variable. This is provided with the <code><a href="../reference/geom_miss_point.html">geom_miss_point()</a></code> ggplot2 geom, which we can illustrate by exploring the relationship between Ozone and Solar radiation from the airquality dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(airquality, 
       <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> Solar.R, 
           <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()</code></pre></div>
<pre><code>## Warning: Removed 42 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(naniar)

<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(airquality, 
       <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> Solar.R, 
           <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/geom_miss_point.html">geom_miss_point</a></span>()</code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/unnamed-chunk-2-1.png" width="50%" style="display: block; margin: auto;"><img src="getting-started-w-naniar_files/figure-html/unnamed-chunk-2-2.png" width="50%" style="display: block; margin: auto;"></p>
<p>Being a proper ggplot geom, it supports all of the standard features of ggplot2, such as <strong>facets</strong>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(airquality, 
       <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> Solar.R, 
           <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/geom_miss_point.html">geom_miss_point</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>Month)</code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/ggmissing-facet-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>And different <strong>themes</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(airquality, 
       <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> Solar.R, 
           <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/geom_miss_point.html">geom_miss_point</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>Month) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_dark</a></span>()</code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/ggmissing-theme-1.png" width="70%" style="display: block; margin: auto;"></p>
<div id="visualising-missings-in-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#visualising-missings-in-variables" class="anchor"></a>Visualising missings in variables</h2>
<p>Another approach to visualising the missings in a dataset is to use the <code>gg_miss_var</code> plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/gg_miss_var.html">gg_miss_var</a></span>(airquality)</code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/unnamed-chunk-3-1.png" width="480" style="display: block; margin: auto;"></p>
<p>This creates a <code>ggplot2</code> object with the number of missing values for each variable, ordered from most missing to least missing. Under the hood, this is powered using <code><a href="../reference/miss_var_summary.html">miss_var_summary()</a></code>, described later.</p>
<p>The plots created with the <code>gg_miss</code> family all have a basic theme, but you can customise them, just like usual ggplot objects. If you call any ggplot customisation functions with a <code>gg_miss</code> object, the default args will be overridden.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/gg_miss_var.html">gg_miss_var</a></span>(airquality) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() </code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/gg_miss_var.html">gg_miss_var</a></span>(airquality) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">y =</span> <span class="st">"Look at all the missing ones"</span>)</code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/unnamed-chunk-4-2.png" width="480" style="display: block; margin: auto;"></p>
<p>It is important to note that for every visualisation of missing data, there is an accompanying function to get the base structure of the plot out. This is important as the plot should not return a dataframe - but we also need to make the data available for use by the user so that it isn’t locked into a plot.</p>
</div>
</div>
<div id="shadow-matrix-a-tidy-way-of-representing-missing-values" class="section level1">
<h1 class="hasAnchor">
<a href="#shadow-matrix-a-tidy-way-of-representing-missing-values" class="anchor"></a>shadow matrix: A tidy way of representing missing values</h1>
<p>Representing missing data structure is achieved using the shadow matrix, introduced in <a href="https://www.researchgate.net/publication/2758672_Missing_Data_in_Interactive_High-Dimensional_Data_Visualization">Swayne and Buja</a>. The shadow matrix is the same dimension as the data, and consists of binary indicators of missingness of data values, where missing is represented as “NA”, and not missing is represented as “!NA”. Although these may be represented as 1 and 0, respectively. This representation can be seen in the figure below, adding the suffix “_NA" to the variables. This structure can also be extended to allow for additional factor levels to be created. For example 0 indicates data presence, 1 indicates missing values, 2 indicates imputed value, and 3 might indicate a particular type or class of missingness, where reasons for missingness might be known or inferred. The data matrix can also be augmented to include the shadow matrix, which facilitates visualisation of univariate and bivariate missing data visualisations. Another format is to display it in long form, which facilitates heatmap style visualisations. This approach can be very helpful for giving an overview of which variables contain the most missingness. Methods can also be applied to rearrange rows and columns to find clusters, and identify other interesting features of the data that may have previously been hidden or unclear.</p>
<p><img src="missingness-data-structures.png" width="800px" style="display: block; margin: auto;"></p>
<p><strong>Illustration of data structures for facilitating visualisation of missings and not missings</strong></p>
<p>The <code>shadow</code> functions provide a way to keep track of missing values. The <code>as_shadow</code> function creates a dataframe with the same set of columns, but with the column names added a suffix <code>_NA</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/as_shadow.html">as_shadow</a></span>(airquality)</code></pre></div>
<pre><code>## # A tibble: 153 x 6
##    Ozone_NA Solar.R_NA Wind_NA Temp_NA Month_NA Day_NA
##      &lt;fctr&gt;     &lt;fctr&gt;  &lt;fctr&gt;  &lt;fctr&gt;   &lt;fctr&gt; &lt;fctr&gt;
##  1      !NA        !NA     !NA     !NA      !NA    !NA
##  2      !NA        !NA     !NA     !NA      !NA    !NA
##  3      !NA        !NA     !NA     !NA      !NA    !NA
##  4      !NA        !NA     !NA     !NA      !NA    !NA
##  5       NA         NA     !NA     !NA      !NA    !NA
##  6      !NA         NA     !NA     !NA      !NA    !NA
##  7      !NA        !NA     !NA     !NA      !NA    !NA
##  8      !NA        !NA     !NA     !NA      !NA    !NA
##  9      !NA        !NA     !NA     !NA      !NA    !NA
## 10       NA        !NA     !NA     !NA      !NA    !NA
## # ... with 143 more rows</code></pre>
<p>The <code>bind_shadow</code> argument attaches a shadow to the current dataframe</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">aq_shadow &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bind_shadow.html">bind_shadow</a></span>(airquality)

<span class="kw">library</span>(dplyr)</code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(aq_shadow)</code></pre></div>
<pre><code>## Observations: 153
## Variables: 12
## $ Ozone      &lt;int&gt; 41, 36, 12, 18, NA, 28, 23, 19, 8, NA, 7, 16, 11, 1...
## $ Solar.R    &lt;int&gt; 190, 118, 149, 313, NA, NA, 299, 99, 19, 194, NA, 2...
## $ Wind       &lt;dbl&gt; 7.4, 8.0, 12.6, 11.5, 14.3, 14.9, 8.6, 13.8, 20.1, ...
## $ Temp       &lt;int&gt; 67, 72, 74, 62, 56, 66, 65, 59, 61, 69, 74, 69, 66,...
## $ Month      &lt;int&gt; 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, ...
## $ Day        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, ...
## $ Ozone_NA   &lt;fctr&gt; !NA, !NA, !NA, !NA, NA, !NA, !NA, !NA, !NA, NA, !N...
## $ Solar.R_NA &lt;fctr&gt; !NA, !NA, !NA, !NA, NA, NA, !NA, !NA, !NA, !NA, NA...
## $ Wind_NA    &lt;fctr&gt; !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, ...
## $ Temp_NA    &lt;fctr&gt; !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, ...
## $ Month_NA   &lt;fctr&gt; !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, ...
## $ Day_NA     &lt;fctr&gt; !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, !NA, ...</code></pre>
<p>Doing this provides a consistent syntax for referring to variables with missing values.</p>
<p><code><a href="../reference/bind_shadow.html">bind_shadow()</a></code> also provides a useful pattern to explore missing values, grouping by the missing/complete of one variable and looking at the mean and other summary values. Below we show the mean, sd, variance, and min and max values of Solar.R for when Ozone is present, and when it is missing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airquality <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/bind_shadow.html">bind_shadow</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Ozone_NA) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise_all.html">summarise_at</a></span>(<span class="dt">.vars =</span> <span class="st">"Solar.R"</span>,
               <span class="dt">.funs =</span> <span class="kw">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"var"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>),
               <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   Ozone_NA     mean       sd      var   min   max
##     &lt;fctr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1      !NA 184.8018 91.15230 8308.742     7   334
## 2       NA 189.5143 87.69478 7690.375    31   332</code></pre>
<p>Below, we can plot the distribution of Temperature, plotting for values of temperature when Ozone is missing, and when it is not missing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(aq_shadow,
       <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> Temp,
           <span class="dt">colour =</span> Ozone_NA)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_density">geom_density</a></span>()</code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/shadow-plot-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>Binding the shadow here also has great benefits when combined with imputation.</p>
</div>
<div id="visualising-imputed-values" class="section level1">
<h1 class="hasAnchor">
<a href="#visualising-imputed-values" class="anchor"></a>Visualising imputed values</h1>
<p>Using the easy-to-use <code>simputation</code> package, we impute values for Ozone, then visualise the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(simputation)
<span class="kw">library</span>(dplyr)

airquality <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/simputation/topics/impute_lm">impute_lm</a></span>(Ozone <span class="op">~</span><span class="st"> </span>Temp <span class="op">+</span><span class="st"> </span>Wind) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> Temp,
             <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()</code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Note that we no longer get any errors regarding missing observations - because they are all imputed! But this comes at a cost: we also no longer have information about where the imputations are - they are now sort of invisible.</p>
<p>Using the shadow matrix to keep track of where the missings are, you can actually keep track of the imputations, by colouring by what was previously missing in Ozone.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">aq_shadow <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/simputation/topics/impute_lm">impute_lm</a></span>(Ozone <span class="op">~</span><span class="st"> </span>Temp <span class="op">+</span><span class="st"> </span>Wind) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> Temp,
             <span class="dt">y =</span> Ozone,
             <span class="dt">colour =</span> Ozone_NA)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()</code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/unnamed-chunk-9-1.png" width="480" style="display: block; margin: auto;"></p>
<div id="numerical-summaries-of-missing-values" class="section level2">
<h2 class="hasAnchor">
<a href="#numerical-summaries-of-missing-values" class="anchor"></a>Numerical summaries of missing values</h2>
<p><code>naniar</code> also provide numerical summaries for missing data. Two convenient counters of complete values and missings are <code>n_miss</code> and <code>n_complete</code>. These work on both dataframes and vectors, similar to <code><a href="http://dplyr.tidyverse.org/reference/n_distinct.html">dplyr::n_distinct</a></code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span>(airquality)</code></pre></div>
<pre><code>## [1] 153</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span>(airquality<span class="op">$</span>Ozone)</code></pre></div>
<pre><code>## [1] 68</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/n_miss.html">n_miss</a></span>(airquality)</code></pre></div>
<pre><code>## [1] 44</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/n_miss.html">n_miss</a></span>(airquality<span class="op">$</span>Ozone)</code></pre></div>
<pre><code>## [1] 37</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/n_complete.html">n_complete</a></span>(airquality)</code></pre></div>
<pre><code>## [1] 874</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/n_complete.html">n_complete</a></span>(airquality<span class="op">$</span>Ozone)</code></pre></div>
<pre><code>## [1] 116</code></pre>
<p>The syntax for the other numerical sumamries in <code>naniar</code> are <code>miss_</code>, and then <code>case</code>, or <code>var</code> to refer to cases or variables. There are then <code>summary</code>, <code>table</code>, <code>run</code>, <code>span</code>, and <code>cumsum</code> options to explore missing data.</p>
<p>The</p>
<p><code>miss_case_prop</code> and <code>miss_case_pct</code> return numeric value describing the proportion or percent of missing values in the dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/miss_case_prop.html">miss_case_prop</a></span>(airquality)</code></pre></div>
<pre><code>## [1] 0.2745098</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/miss_case_pct.html">miss_case_pct</a></span>(airquality)</code></pre></div>
<pre><code>## [1] 27.45098</code></pre>
<p><code>miss_case_summary</code> returns a numeric value that describes the number of missings in a given case (aka row), the percent of missings in that row.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/miss_case_summary.html">miss_case_summary</a></span>(airquality)</code></pre></div>
<pre><code>## # A tibble: 153 x 3
##     case n_missing  percent
##    &lt;int&gt;     &lt;int&gt;    &lt;dbl&gt;
##  1     5         2 33.33333
##  2    27         2 33.33333
##  3     6         1 16.66667
##  4    10         1 16.66667
##  5    11         1 16.66667
##  6    25         1 16.66667
##  7    26         1 16.66667
##  8    32         1 16.66667
##  9    33         1 16.66667
## 10    34         1 16.66667
## # ... with 143 more rows</code></pre>
<p><code>miss_case_table</code> tabulates the number of missing values in a case / row. Below, this shows the number of missings in a case:</p>
<ul>
<li>There are 111 cases with 0 missings, which comprises about 72% of the data.</li>
<li>There are then 40 cases with 1 missing, these make up 26% of the data.</li>
<li>There are then 2 cases with 2 missing - these make up 1% of the data.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/miss_case_table.html">miss_case_table</a></span>(airquality)</code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   n_missing_in_case n_cases  percent
##               &lt;int&gt;   &lt;int&gt;    &lt;dbl&gt;
## 1                 0     111 72.54902
## 2                 1      40 26.14379
## 3                 2       2  1.30719</code></pre>
<p>Similar to <code><a href="../reference/miss_case_pct.html">miss_case_pct()</a></code> and <code><a href="../reference/miss_case_prop.html">miss_case_prop()</a></code>, <code><a href="../reference/miss_var_pct.html">miss_var_pct()</a></code> and <code><a href="../reference/miss_var_prop.html">miss_var_prop()</a></code> returns the percent and proportion of variables that contain a missing value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/miss_var_prop.html">miss_var_prop</a></span>(airquality)</code></pre></div>
<pre><code>## [1] 0.3333333</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/miss_var_pct.html">miss_var_pct</a></span>(airquality)</code></pre></div>
<pre><code>## [1] 33.33333</code></pre>
<p><code>miss_var_summary</code> then returns the number of missing values in a variable, and the percent missing in that variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/miss_var_summary.html">miss_var_summary</a></span>(airquality)</code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   variable n_missing   percent
##      &lt;chr&gt;     &lt;int&gt;     &lt;dbl&gt;
## 1    Ozone        37 24.183007
## 2  Solar.R         7  4.575163
## 3     Wind         0  0.000000
## 4     Temp         0  0.000000
## 5    Month         0  0.000000
## 6      Day         0  0.000000</code></pre>
<p>Finally, <code>miss_var_table</code>. This describes the number of missings in a variable.</p>
<ul>
<li>There are 4 variables with 0 missings, comprising 66.67% of variables in the dataset.</li>
<li>There is 1 variable with 7 missings</li>
<li>There is 1 variable with 37 missings</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/miss_var_table.html">miss_var_table</a></span>(airquality)</code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   n_missing_in_var n_vars  percent
##              &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
## 1                0      4 66.66667
## 2                7      1 16.66667
## 3               37      1 16.66667</code></pre>
<p>There are also summary functions for exploring missings that occur over a particular span or period of the dataset, or the number of missings in a single run:</p>
<ul>
<li>
<code><a href="../reference/miss_var_run.html">miss_var_run()</a></code>, and</li>
<li><code><a href="../reference/miss_var_span.html">miss_var_span()</a></code></li>
</ul>
<p><code>miss_var_run</code> can be particularly useful in time series data, as it allows you to provide summaries for the number of missings or complete values in a single run. The function <code><a href="../reference/miss_var_run.html">miss_var_run()</a></code> provides a data.frame of the run length of missings and complete values. To explore this function we will use the built-in dataset, <code>pedestrian</code>, which contains hourly counts of pedestrians from four locations around Melbourne, Australia, from 2016.</p>
<p>To use <code>miss_var_run</code>, you specify the variable that you want to explore the runs of missingness for, in this case, <code>hourly_counts</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/miss_var_run.html">miss_var_run</a></span>(pedestrian,
             hourly_counts)</code></pre></div>
<pre><code>## # A tibble: 35 x 2
##    run_length    is_na
##         &lt;int&gt;    &lt;chr&gt;
##  1       6628 complete
##  2          1  missing
##  3       5250 complete
##  4        624  missing
##  5       3652 complete
##  6          1  missing
##  7       1290 complete
##  8        744  missing
##  9       7420 complete
## 10          1  missing
## # ... with 25 more rows</code></pre>
<p><code><a href="../reference/miss_var_span.html">miss_var_span()</a></code> is used to determine the number of missings over a specified repeating span of rows in variable of a dataframe. Similar to <code><a href="../reference/miss_var_run.html">miss_var_run()</a></code>, you specify the variable that you wish to explore, you then also specify the size of the span with the <code>span_every</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/miss_var_span.html">miss_var_span</a></span>(pedestrian,
              hourly_counts,
              <span class="dt">span_every =</span> <span class="dv">100</span>)</code></pre></div>
<pre><code>## # A tibble: 377 x 5
##    span_counter n_miss n_complete prop_miss prop_complete
##           &lt;int&gt;  &lt;int&gt;      &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
##  1            1      0        100         0             1
##  2            2      0        100         0             1
##  3            3      0        100         0             1
##  4            4      0        100         0             1
##  5            5      0        100         0             1
##  6            6      0        100         0             1
##  7            7      0        100         0             1
##  8            8      0        100         0             1
##  9            9      0        100         0             1
## 10           10      0        100         0             1
## # ... with 367 more rows</code></pre>
</div>
</div>
<div id="using-group_by-with-naniar" class="section level1">
<h1 class="hasAnchor">
<a href="#using-group_by-with-naniar" class="anchor"></a>Using <code>group_by</code> with naniar</h1>
<p>Every <code>miss_*</code> summary function that returns a dataframe can be used with dplyr <code>group_by</code>. For example, if you would like to look at the number of missing values for all variables of pedestrian data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pedestrian <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/miss_var_summary.html">miss_var_summary</a></span>()</code></pre></div>
<pre><code>## # A tibble: 9 x 3
##        variable n_missing  percent
##           &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt;
## 1 hourly_counts      2548 6.758621
## 2     date_time         0 0.000000
## 3          year         0 0.000000
## 4         month         0 0.000000
## 5     month_day         0 0.000000
## 6      week_day         0 0.000000
## 7          hour         0 0.000000
## 8     sensor_id         0 0.000000
## 9   sensor_name         0 0.000000</code></pre>
<p>We see that this is in <code>hourly_counts</code>. We can then explore this by month, and filder by the variable being <code>hourly_counts</code>, since it is the only one with missing values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pedestrian <span class="op">%&gt;%</span>
<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(month) <span class="op">%&gt;%</span>
<span class="st"> </span><span class="kw"><a href="../reference/miss_var_summary.html">miss_var_summary</a></span>() <span class="op">%&gt;%</span>
<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(variable <span class="op">==</span><span class="st"> "hourly_counts"</span>)</code></pre></div>
<pre><code>## # A tibble: 12 x 4
##        month      variable n_missing   percent
##        &lt;ord&gt;         &lt;chr&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1   January hourly_counts         0  0.000000
##  2  February hourly_counts         0  0.000000
##  3     March hourly_counts         0  0.000000
##  4     April hourly_counts       552 19.166667
##  5       May hourly_counts        72  2.419355
##  6      June hourly_counts         0  0.000000
##  7      July hourly_counts         0  0.000000
##  8    August hourly_counts       408 13.709677
##  9 September hourly_counts         0  0.000000
## 10   October hourly_counts       412  7.436823
## 11  November hourly_counts       888 30.833333
## 12  December hourly_counts       216  7.258065</code></pre>
</div>
<div id="modelling-missingness" class="section level1">
<h1 class="hasAnchor">
<a href="#modelling-missingness" class="anchor"></a>Modelling missingness</h1>
<p>The final question we proposed in this vignette was:</p>
<ol start="3" style="list-style-type: decimal">
<li>Can we model missingness?</li>
</ol>
<p>Sometimes it can be impractical to explore all of the variables that have missing data. One approach, however, is to model missing data using methods from Tierney et el. (2015).</p>
<p>Here, the approach is to predict the proportion of missingness in a given case, using all variables. There is a little helper function to add a column with the proportion of cases or rows missing - <code>add_prop_miss</code>. This created a column named “prop_miss”, which is the proportion of missing values in that row.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airquality <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/add_prop_miss.html">add_prop_miss</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>()</code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   Ozone Solar.R  Wind  Temp Month   Day prop_miss_all
##   &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;dbl&gt;
## 1    41     190   7.4    67     5     1     0.0000000
## 2    36     118   8.0    72     5     2     0.0000000
## 3    12     149  12.6    74     5     3     0.0000000
## 4    18     313  11.5    62     5     4     0.0000000
## 5    NA      NA  14.3    56     5     5     0.3333333
## 6    28      NA  14.9    66     5     6     0.1666667</code></pre>
<p>We can then use a model like decision trees to predict which variables and their values are important for predicting the proportion of missingness:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rpart)
<span class="kw">library</span>(rpart.plot)

airquality <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/add_prop_miss.html">add_prop_miss</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/rpart/topics/rpart">rpart</a></span>(prop_miss_all <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> .) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/rpart.plot/topics/prp">prp</a></span>(<span class="dt">type =</span> <span class="dv">4</span>, <span class="dt">extra =</span> <span class="dv">101</span>, <span class="dt">prefix =</span> <span class="st">"Prop. Miss = "</span>)</code></pre></div>
<p><img src="getting-started-w-naniar_files/figure-html/rpart-miss-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># library(visdat)</span>
<span class="co"># vis_miss(messy_airquality)</span></code></pre></div>
<p>Here we can see that this produces quite a complex tree - this can be pruned back and the depth of the decision tree controlled.</p>
</div>
<div id="summary" class="section level1">
<h1 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h1>
<p>The tools in <code>naniar</code> help us identify where missingness is, while maintaining a tidy workflow. We care about these mechanisms or these patterns because they can help us understand potential mechanisms, such as equipment failures, and then identify possible solutions based upon this evidence.</p>
</div>
<div id="future-development" class="section level1">
<h1 class="hasAnchor">
<a href="#future-development" class="anchor"></a>Future development</h1>
<ul>
<li>Make <code>naniar</code> work with big data tools like <code>sparklyr</code>, and <code>sparklingwater</code>.</li>
<li>Further develop methods for handling and visualising imputations, and multiple imputation. Other plans to extend the <code>geom_miss_</code> family to include:</li>
<li>Categorical variables</li>
<li>Bivariate plots: scatterplots, density overlays</li>
<li>SQL translation for databases</li>
<li>Big Data tools (sparklyr, sparklingwater)</li>
<li>Work well with other imputation engines / processes</li>
<li>Provide tools for assessing goodness of fit for classical approaches of MCAR, MAR, and MNAR (graphical inference from <code>nullabor</code> package)</li>
<li>Expand ggplot <code>geom_miss_*</code> family</li>
</ul>
</div>
<div id="thank-you" class="section level1">
<h1 class="hasAnchor">
<a href="#thank-you" class="anchor"></a>Thank you</h1>
<p>Firstly, thanks to Di Cook for giving the initial inspiration for the package and laying down the rich theory and literature that the work in <code>naniar</code> is built upon. Naming credit (once again!) goes to Miles McBain. Among various other things, Miles also worked out how to overload the missing data and make it work as a geom. Thanks also to Colin Fay for helping me understand tidy evaluation and for features such as <code>replace_to_na</code>, <code>miss_*_cumsum</code>, and more.</p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<ul>
<li>MANET: <a href="http://www.rosuda.org/MANET/" class="uri">http://www.rosuda.org/MANET/</a>
</li>
<li>ggobi: <a href="http://www.ggobi.org/" class="uri">http://www.ggobi.org/</a>
</li>
<li>visdat: <a href="https://www.github.com/ropensci/visdat" class="uri">https://www.github.com/ropensci/visdat</a>
</li>
<li>Tierney NJ, Harden FA, Harden MJ, Mengersen, KA, Using decision trees to understand structure in missing data BMJ Open 2015;5:e007450. doi: 10.1136/bmjopen-2014-007450</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#how-do-we-start-looking-at-missing-data">How do we start looking at missing data?</a><ul class="nav nav-pills nav-stacked">
<li><a href="#vis_dat"><code>vis_dat</code></a></li>
      </ul>
</li>
      <li>
<a href="#exploring-missingness-relationships">Exploring missingness relationships</a><ul class="nav nav-pills nav-stacked">
<li><a href="#visualising-missings-in-variables">Visualising missings in variables</a></li>
      </ul>
</li>
      <li><a href="#shadow-matrix-a-tidy-way-of-representing-missing-values">shadow matrix: A tidy way of representing missing values</a></li>
      <li>
<a href="#visualising-imputed-values">Visualising imputed values</a><ul class="nav nav-pills nav-stacked">
<li><a href="#numerical-summaries-of-missing-values">Numerical summaries of missing values</a></li>
      </ul>
</li>
      <li><a href="#using-group_by-with-naniar">Using <code>group_by</code> with naniar</a></li>
      <li><a href="#modelling-missingness">Modelling missingness</a></li>
      <li><a href="#summary">Summary</a></li>
      <li><a href="#future-development">Future development</a></li>
      <li><a href="#thank-you">Thank you</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nicholas Tierney, Di Cook, Miles McBain, Colin Fay.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
