<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Exploring Imputed Values • naniar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Exploring Imputed Values">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">naniar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/naniar.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/naniar-visualisation.html">Gallery</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/replace-with-na.html">Replace with NA</a></li>
    <li><a class="dropdown-item" href="../articles/special-missing-values.html">Special Missings</a></li>
    <li><a class="dropdown-item" href="../articles/exploring-imputed-values.html">Exploring Imputations</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.njtierney.com/post/2024/03/04/naniar-version-1-1-0-prince-caspian/">Version 1.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.njtierney.com/post/2023/02/07/naniar-version-1/">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/njtierney/naniar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Exploring Imputed Values</h1>
                        <h4 data-toc-skip class="author">Nicholas
Tierney</h4>
            
            <h4 data-toc-skip class="date">2025-04-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/njtierney/naniar/blob/main/vignettes/exploring-imputed-values.Rmd" class="external-link"><code>vignettes/exploring-imputed-values.Rmd</code></a></small>
      <div class="d-none name"><code>exploring-imputed-values.Rmd</code></div>
    </div>

    
    
<p>Imputating missing values is an iterative process.
<code>naniar</code> aims to make it easier to manage imputed values by
providing the <code>nabular</code> data structure to simplify managing
missingness. This vignette provides some useful recipes for imputing and
exploring imputed data.</p>
<p><code>naniar</code> implements a few imputation methods to facilitate
exploration and visualisations, which were not otherwise available:
<code>impute_below</code>, and <code>impute_mean</code>. For single
imputation, the R package <code>simputation</code> works very well with
<code>naniar</code>, and provides the main example given.</p>
<div class="section level2">
<h2 id="imputing-and-tracking-missing-values">Imputing and tracking missing values<a class="anchor" aria-label="anchor" href="#imputing-and-tracking-missing-values"></a>
</h2>
</div>
<div class="section level2">
<h2 id="using-impute_below">Using <code>impute_below</code><a class="anchor" aria-label="anchor" href="#using-impute_below"></a>
</h2>
<p><code>impute_below</code> imputes values below the minimum of the
data, with some noise to reduce overplotting. The amount data is imputed
below, and the amount of jitter, can be changed by changing the
arguments <code>prop_below</code> and <code>jitter</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/njtierney/naniar" class="external-link">naniar</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">airquality</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/impute_below_at.html">impute_below_at</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Ozone</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Ozone</span>, <span class="va">Solar.R</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Ozone Solar.R</span></span>
<span><span class="co">#&gt; 1  41.00000     190</span></span>
<span><span class="co">#&gt; 2  36.00000     118</span></span>
<span><span class="co">#&gt; 3  12.00000     149</span></span>
<span><span class="co">#&gt; 4  18.00000     313</span></span>
<span><span class="co">#&gt; 5 -19.72321      NA</span></span>
<span><span class="co">#&gt; 6  28.00000      NA</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-impute_mean">Using <code>impute_mean</code><a class="anchor" aria-label="anchor" href="#using-impute_mean"></a>
</h2>
<p>The mean can be imputed using <code>impute_mean</code>, and is useful
to explore structure in missingness, but are not recommended for use in
analysis. Similar to <code>simputation</code>, each <code>impute_</code>
function returns the data with values imputed.</p>
<p>Imputation functions in <code>naniar</code> implement “scoped
variants” for imputation: <code>_all</code>, <code>_at</code> and
<code>_if</code>.</p>
<p>This means:</p>
<ul>
<li>
<code>_all</code> operates on all columns</li>
<li>
<code>_at</code> operates on specific columns, and</li>
<li>
<code>_if</code> operates on columns that meet some condition (such
as <code>is.numeric</code> or <code>is.character</code>).</li>
</ul>
<p>If the <code>impute_</code> functions are used as-is - e.g.,
<code>impute_mean</code>, this will work on a single vector, but not a
data.frame.</p>
<p>Some examples for <code>impute_mean</code> are now given:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/impute_mean.html">impute_mean</a></span><span class="op">(</span><span class="va">oceanbuoys</span><span class="op">$</span><span class="va">air_temp_c</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 27.15 27.02 27.00 26.93 26.84 26.94</span></span>
<span></span>
<span><span class="fu"><a href="../reference/scoped-impute_mean.html">impute_mean_at</a></span><span class="op">(</span><span class="va">oceanbuoys</span>, .vars <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">air_temp_c</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;    year latitude longitude sea_temp_c air_temp_c humidity wind_ew wind_ns</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       27.1     79.6   -<span style="color: #BB0000;">6.40</span>    5.40</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.5       27.0     75.8   -<span style="color: #BB0000;">5.30</span>    5.30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       27       76.5   -<span style="color: #BB0000;">5.10</span>    4.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       26.9     76.2   -<span style="color: #BB0000;">4.90</span>    2.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       26.8     76.4   -<span style="color: #BB0000;">3.5</span>     4.10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.8       26.9     76.7   -<span style="color: #BB0000;">4.40</span>    1.60</span></span>
<span></span>
<span><span class="fu"><a href="../reference/scoped-impute_mean.html">impute_mean_if</a></span><span class="op">(</span><span class="va">oceanbuoys</span>, .predicate <span class="op">=</span> <span class="va">is.integer</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;    year latitude longitude sea_temp_c air_temp_c humidity wind_ew wind_ns</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       27.1     79.6   -<span style="color: #BB0000;">6.40</span>    5.40</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.5       27.0     75.8   -<span style="color: #BB0000;">5.30</span>    5.30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       27       76.5   -<span style="color: #BB0000;">5.10</span>    4.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       26.9     76.2   -<span style="color: #BB0000;">4.90</span>    2.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       26.8     76.4   -<span style="color: #BB0000;">3.5</span>     4.10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.8       26.9     76.7   -<span style="color: #BB0000;">4.40</span>    1.60</span></span>
<span></span>
<span><span class="fu"><a href="../reference/scoped-impute_mean.html">impute_mean_all</a></span><span class="op">(</span><span class="va">oceanbuoys</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;    year latitude longitude sea_temp_c air_temp_c humidity wind_ew wind_ns</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       27.1     79.6   -<span style="color: #BB0000;">6.40</span>    5.40</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.5       27.0     75.8   -<span style="color: #BB0000;">5.30</span>    5.30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       27       76.5   -<span style="color: #BB0000;">5.10</span>    4.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       26.9     76.2   -<span style="color: #BB0000;">4.90</span>    2.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.6       26.8     76.4   -<span style="color: #BB0000;">3.5</span>     4.10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">1</span>997        0      -<span style="color: #BB0000;">110</span>       27.8       26.9     76.7   -<span style="color: #BB0000;">4.40</span>    1.60</span></span></code></pre></div>
<p>When we impute data like this, we cannot identify where the imputed
values are - we need to track them. We can track the imputed values
using the <code>nabular</code> format of the data.</p>
<div class="section level4">
<h4 id="track-imputed-values-using-nabular-data">Track imputed values using nabular data<a class="anchor" aria-label="anchor" href="#track-imputed-values-using-nabular-data"></a>
</h4>
<p>We can track the missing values by combining the verbs
<code>bind_shadow</code>, <code>impute_</code>,
<code>add_label_shadow</code>. We can then refer to missing values by
their shadow variable, <code>_NA</code>. The
<code>add_label_shadow</code> function adds an additional column called
<code>any_missing</code>, which tells us if any observation has a
missing value.</p>
<div class="section level5">
<h5 id="imputing-values-using-simputation">Imputing values using simputation<a class="anchor" aria-label="anchor" href="#imputing-values-using-simputation"></a>
</h5>
<p>We can impute the data using the easy-to-use <code>simputation</code>
package, and then track the missingness using <code>bind_shadow</code>
and <code>add_label_shadow</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/markvanderloo/simputation" class="external-link">simputation</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'simputation'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:naniar':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     impute_median</span></span>
<span><span class="va">ocean_imp</span> <span class="op">&lt;-</span> <span class="va">oceanbuoys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/bind_shadow.html">bind_shadow</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/simputation/man/impute_lm.html" class="external-link">impute_lm</a></span><span class="op">(</span><span class="va">air_temp_c</span> <span class="op">~</span> <span class="va">wind_ew</span> <span class="op">+</span> <span class="va">wind_ns</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/simputation/man/impute_lm.html" class="external-link">impute_lm</a></span><span class="op">(</span><span class="va">humidity</span> <span class="op">~</span>  <span class="va">wind_ew</span> <span class="op">+</span> <span class="va">wind_ns</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/simputation/man/impute_lm.html" class="external-link">impute_lm</a></span><span class="op">(</span><span class="va">sea_temp_c</span> <span class="op">~</span>  <span class="va">wind_ew</span> <span class="op">+</span> <span class="va">wind_ns</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_label_shadow.html">add_label_shadow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can then show the previously missing (now imputed!) data in a
scatterplot with ggplot2 by setting the <code>color</code> aesthetic in
ggplot to <code>any_missing</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ocean_imp</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">air_temp_c</span>,</span>
<span>           y <span class="op">=</span> <span class="va">humidity</span>,</span>
<span>           color <span class="op">=</span> <span class="va">any_missing</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="exploring-imputed-values_files/figure-html/ocean-imp-air-temp-humidity-1.png" width="700"></p>
<p>Or, if you want to look at one variable, you can look at a density
plot of one variable, using <code>fill = any_missing</code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ocean_imp</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">air_temp_c</span>,</span>
<span>           fill <span class="op">=</span> <span class="va">any_missing</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ocean_imp</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">humidity</span>,</span>
<span>           fill <span class="op">=</span> <span class="va">any_missing</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="exploring-imputed-values_files/figure-html/ocean-imp-density-1.png" width="49%"><img src="exploring-imputed-values_files/figure-html/ocean-imp-density-2.png" width="49%"></p>
<p>We can also compare imputed values to complete cases by grouping by
<code>any_missing</code>, and summarising.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ocean_imp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">any_missing</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_at</a></span><span class="op">(</span>.vars <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">air_temp_c</span><span class="op">)</span>,</span>
<span>               .funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                 min <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                 mean <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                 median <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                 max <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>              <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   any_missing   min  mean median   max</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Missing      21.4  23.9   24.4  25.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Not Missing  22.1  25.3   25.8  28.5</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="improving-imputations">Improving imputations<a class="anchor" aria-label="anchor" href="#improving-imputations"></a>
</h2>
<p>One thing that we notice with our imputations are that they aren’t
very good - we can improve upon the imputation by including the
variables year and latitude and longitude:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ocean_imp_yr</span> <span class="op">&lt;-</span> <span class="va">oceanbuoys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/bind_shadow.html">bind_shadow</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/simputation/man/impute_lm.html" class="external-link">impute_lm</a></span><span class="op">(</span><span class="va">air_temp_c</span> <span class="op">~</span> <span class="va">wind_ew</span> <span class="op">+</span> <span class="va">wind_ns</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="va">longitude</span> <span class="op">+</span> <span class="va">latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/simputation/man/impute_lm.html" class="external-link">impute_lm</a></span><span class="op">(</span><span class="va">humidity</span> <span class="op">~</span>  <span class="va">wind_ew</span> <span class="op">+</span> <span class="va">wind_ns</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="va">longitude</span> <span class="op">+</span> <span class="va">latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/simputation/man/impute_lm.html" class="external-link">impute_lm</a></span><span class="op">(</span><span class="va">sea_temp_c</span> <span class="op">~</span>  <span class="va">wind_ew</span> <span class="op">+</span> <span class="va">wind_ns</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="va">longitude</span> <span class="op">+</span> <span class="va">latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_label_shadow.html">add_label_shadow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ocean_imp_yr</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">air_temp_c</span>,</span>
<span>           y <span class="op">=</span> <span class="va">humidity</span>,</span>
<span>           color <span class="op">=</span> <span class="va">any_missing</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="exploring-imputed-values_files/figure-html/ggplot-air-temp-humidity-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="other-imputation-approaches">Other imputation approaches<a class="anchor" aria-label="anchor" href="#other-imputation-approaches"></a>
</h2>
<p>Not all imputation packages return data in tidy</p>
<div class="section level3">
<h3 id="hmisc-aregimpute">Hmisc aregImpute<a class="anchor" aria-label="anchor" href="#hmisc-aregimpute"></a>
</h3>
<p>We can explore using a single imputation of
<code><a href="https://rdrr.io/pkg/Hmisc/man/aregImpute.html" class="external-link">Hmisc::aregImpute()</a></code>, which allows for multiple imputation
with bootstrapping, additive regression, and predictive mean matching.
We are going to explore predicting mean matching, and single
imputation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/Hmisc/" class="external-link">Hmisc</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'Hmisc'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:simputation':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     impute</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     src, summarize</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     format.pval, units</span></span>
<span></span>
<span><span class="va">aq_imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/aregImpute.html" class="external-link">aregImpute</a></span><span class="op">(</span><span class="op">~</span><span class="va">Ozone</span> <span class="op">+</span> <span class="va">Temp</span> <span class="op">+</span> <span class="va">Wind</span> <span class="op">+</span> <span class="va">Solar.R</span>,</span>
<span>                     n.impute <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                     type <span class="op">=</span> <span class="st">"pmm"</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">airquality</span><span class="op">)</span></span>
<span><span class="co">#&gt; Iteration 1 Iteration 2 Iteration 3 Iteration 4 </span></span>
<span></span>
<span><span class="va">aq_imp</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Imputation using Bootstrap and PMM</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; aregImpute(formula = ~Ozone + Temp + Wind + Solar.R, data = airquality, </span></span>
<span><span class="co">#&gt;     n.impute = 1, type = "pmm")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; n: 153   p: 4    Imputations: 1      nk: 3 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of NAs:</span></span>
<span><span class="co">#&gt;   Ozone    Temp    Wind Solar.R </span></span>
<span><span class="co">#&gt;      37       0       0       7 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         type d.f.</span></span>
<span><span class="co">#&gt; Ozone      s    2</span></span>
<span><span class="co">#&gt; Temp       s    2</span></span>
<span><span class="co">#&gt; Wind       s    2</span></span>
<span><span class="co">#&gt; Solar.R    s    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Transformation of Target Variables Forced to be Linear</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; R-squares for Predicting Non-Missing Values for Each Variable</span></span>
<span><span class="co">#&gt; Using Last Imputations of Predictors</span></span>
<span><span class="co">#&gt;   Ozone Solar.R </span></span>
<span><span class="co">#&gt;   0.667   0.224</span></span></code></pre></div>
<p>We are now going to get our data into <code>nabular</code> form, and
then insert the imputed values:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># nabular form!</span></span>
<span><span class="va">aq_nab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nabular.html">nabular</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="../reference/add_label_shadow.html">add_label_shadow</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># insert imputed values</span></span>
<span><span class="va">aq_nab</span><span class="op">$</span><span class="va">Ozone</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">aq_nab</span><span class="op">$</span><span class="va">Ozone</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">aq_imp</span><span class="op">$</span><span class="va">imputed</span><span class="op">$</span><span class="va">Ozone</span></span>
<span><span class="va">aq_nab</span><span class="op">$</span><span class="va">Solar.R</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">aq_nab</span><span class="op">$</span><span class="va">Solar.R</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">aq_imp</span><span class="op">$</span><span class="va">imputed</span><span class="op">$</span><span class="va">Solar.R</span></span></code></pre></div>
<p>In the future there will be a more concise way to insert these
imputed values into data, but for the moment the method above is what I
would recommend for single imputation.</p>
<p>We can then explore the imputed values like so:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">aq_nab</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Ozone</span>,</span>
<span>           y <span class="op">=</span> <span class="va">Solar.R</span>,</span>
<span>           colour <span class="op">=</span> <span class="va">any_missing</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exploring-imputed-values_files/figure-html/hmisc-aregimpute-vis-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://njtierney.com/" class="external-link">Nicholas Tierney</a>, <a href="https://www.dicook.org/" class="external-link">Di Cook</a>, <a href="https://milesmcbain.xyz/" class="external-link">Miles McBain</a>, <a href="https://colinfay.me/" class="external-link">Colin Fay</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
